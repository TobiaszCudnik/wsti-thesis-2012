e = module.exports

class e.Semaphore
	blocks: null
	val: null
																															  
	constructor: (@val = 0) ->
		@blocks = []
																																																														    
	wait: (block) ->
		@val--
		@blocks.push block
		if @val
			@block()
																																																														    
	block: (next) ->
		if @blocks.length
			@blocks.shift() next
		else
			next()
																																																														    
	signal: (next) ->
		@val++
		# async
		process.nextTick @block.bind @, next

class e.Mutex extends e.Semaphore
	constructor: ->
		super 1